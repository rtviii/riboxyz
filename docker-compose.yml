version: '3.8'
services:
  django:
    build: ./rbxz_bend
    image: rbxz_bend
    ports:
      - 8000:8000
    volumes:
      - /home/rxz/dev/docker_together/rbxz_bend:/home/backend/django
      - type: bind
        source: ${RIBETL_DATA:?err}
        target: /home/backend/django/ribetldata

  neo4j:
    image: neo4j:4.4
    network_mode: "bridge"
    ports:
      - "7474:7474"
      - "7687:7687"
    environment:
      - NEO4J_dbms_security_procedures_unrestricted=apoc.*
      - NEO4J_dbms_security_procedures_allowlist=apoc.*
      - NEO4JLABS_PLUGINS=["apoc"]
      - NEO4J_apoc_import_file_enabled=true
      - NEO4J_server_directories_logs=/data
      - NEO4J_apoc_import_file_use__neo4j__config=false

    volumes:
      - ./volume/plugins:/plugins
      - ./volume/data:/data

      - type  : bind
        source: ${RIBETL_DATA:?err}
        target: /import

volumes:
  django:
  neo4j:
