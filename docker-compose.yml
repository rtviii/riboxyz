services:
  django:
    env_file:
        - ./.env
    build:
      context: .
      dockerfile: Dockerfile-django
    container_name: django
    restart: always
    ports:
      - 8000:8000
    volumes:
      - type: bind
        source: ${RIBETL_DATA:?err}
        target: /home/RIBETL_DATA

      # *FOR LIVE DEVELOPMENT -----------------------|
      # - What this does is it mounts the local version of the ribxz_api folder to the container's /home/ribxz_api
      # So instead of just a static mounted version inside the container,
      # the changes made to the local ribxz folder will be reflected inside the container 
      # while it is running. 
      # - ./ribxz_api:/home/ribxz_api                    #|  <--- DEV ONLY
      #* --------------------------------------------|

    environment:
      - NEO4J_URI=bolt://neo:7687
      - NEO4J_USER=neo4j
      - NEO4J_PASSWORD=ribosomexyz
      - NEO4J_CURRENTDB=neo4j

    links:
      - neo
    depends_on:
      - neo
  neo:
    hostname: neo
    container_name: neo
    image: neo4j:5.19-enterprise
    restart: always
    # build:
    #   context: .
    #   dockerfile: Dockerfile-neo4j

    environment:
      - NEO4J_AUTH=none #this disables auth on a fresh node 
      - NEO4J_ACCEPT_LICENSE_AGREEMENT=eval 

    ports:

      - 7473:7473
      - 7474:7474
      - 7687:7687

    volumes:

      - ${NEO4J_MOUNTPATH}/plugins:/var/lib/neo4j/plugins
      - ${NEO4J_MOUNTPATH}/data:/var/lib/neo4j/data
      - ${NEO4J_MOUNTPATH}/conf:/var/lib/neo4j/conf
      - ${NEO4J_MOUNTPATH}/logs:/var/lib/neo4j/logs

      - type  : bind
        source: ${RIBETL_DATA:?err}
        target: /import/RIBETL_DATA
        read_only: true

        
        
